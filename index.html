<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SFX Mobile V9 - Smart Export</title>
    <style>
        :root { --accent: #ff00ff; --accent2: #00ffff; --bg: #0f0f0f; --card: #1a1a1a; --text: #eee; }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 550px; padding-bottom: 140px; }
        header { width: 100%; padding: 15px 0; text-align: center; color: var(--accent); font-weight: bold; text-transform: uppercase; letter-spacing: 2px; }
        section { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #333; }
        .osc1-box { border-top: 4px solid var(--accent); }
        .osc2-box { border-top: 4px solid var(--accent2); }
        h3 { font-size: 0.75rem; color: #888; margin: 0 0 12px 0; text-transform: uppercase; display: flex; justify-content: space-between; }
        .control-group { margin-bottom: 12px; }
        .label-row { display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.8rem; }
        .val { font-family: monospace; font-weight: bold; }
        .v1 { color: var(--accent); } .v2 { color: var(--accent2); }
        select { width: 100%; padding: 8px; background: #333; color: white; border: none; border-radius: 6px; font-size: 0.9rem; }
        input[type="range"] { width: 100%; height: 25px; background: transparent; appearance: none; }
        input[type="range"]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #444; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { appearance: none; height: 22px; width: 22px; border-radius: 50%; margin-top: -9px; }
        #freq::-webkit-slider-thumb, #slide::-webkit-slider-thumb, #atk::-webkit-slider-thumb, #rel::-webkit-slider-thumb { background: var(--accent); }
        #freq2::-webkit-slider-thumb, #slide2::-webkit-slider-thumb, #atk2::-webkit-slider-thumb, #rel2::-webkit-slider-thumb { background: var(--accent2); }
        .mix-panel { background: #222; text-align: center; border: 2px solid #444; }
        .footer-controls { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(10,10,10,0.9); padding: 15px; display: flex; gap: 10px; border-top: 1px solid #333; z-index: 100; }
        button { flex: 1; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }
        .btn-play { background: linear-gradient(45deg, var(--accent), var(--accent2)); color: white; font-size: 1.1rem; }
        .io-area { width: 100%; height: 60px; background: #000; color: #0f0; border-radius: 8px; padding: 8px; font-size: 0.6rem; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <header>SFX SMART ENGINE V9</header>

    <section class="mix-panel">
        <h3>Master Balance</h3>
        <div class="control-group">
            <div class="label-row"><span>OSC 1 (Pink)</span><span>MIX</span><span>OSC 2 (Cyan)</span></div>
            <input type="range" id="mix" min="0" max="1" step="0.01" value="0.5">
            <div class="label-row"><span class="v1" id="mix-v1">50%</span><span></span><span class="v2" id="mix-v2">50%</span></div>
        </div>
    </section>

    <section class="osc1-box">
        <h3>OSC 1</h3>
        <select id="type"><option value="sine">Sine</option><option value="square">Square</option><option value="sawtooth" selected>Sawtooth</option><option value="triangle">Triangle</option><option value="noise">Noise</option></select>
        <div class="control-group"><div class="label-row"><span>Freq</span><span class="val v1" id="freq-val"></span></div><input type="range" id="freq" min="20" max="3000" value="440"></div>
        <div class="control-group"><div class="label-row"><span>Slide</span><span class="val v1" id="slide-val"></span></div><input type="range" id="slide" min="-1500" max="1500" value="0"></div>
        <div class="control-group"><div class="label-row"><span>Atk</span><span class="val v1" id="atk-val"></span></div><input type="range" id="atk" min="0" max="1" step="0.01" value="0.01"></div>
        <div class="control-group"><div class="label-row"><span>Rel</span><span class="val v1" id="rel-val"></span></div><input type="range" id="rel" min="0.01" max="2" step="0.01" value="0.5"></div>
    </section>

    <section class="osc2-box">
        <h3>OSC 2</h3>
        <select id="type2"><option value="sine">Sine</option><option value="square">Square</option><option value="sawtooth">Sawtooth</option><option value="triangle" selected>Triangle</option><option value="noise">Noise</option></select>
        <div class="control-group"><div class="label-row"><span>Freq</span><span class="val v2" id="freq2-val"></span></div><input type="range" id="freq2" min="20" max="3000" value="880"></div>
        <div class="control-group"><div class="label-row"><span>Slide</span><span class="val v2" id="slide2-val"></span></div><input type="range" id="slide2" min="-1500" max="1500" value="0"></div>
        <div class="control-group"><div class="label-row"><span>Atk</span><span class="val v2" id="atk2-val"></span></div><input type="range" id="atk2" min="0" max="1" step="0.01" value="0.01"></div>
        <div class="control-group"><div class="label-row"><span>Rel</span><span class="val v2" id="rel2-val"></span></div><input type="range" id="rel2" min="0.01" max="2" step="0.01" value="0.3"></div>
    </section>

    <section>
        <button style="background:#444; color:white; width:100%;" onclick="exportCode()">EXPORT SMART CODE</button>
        <textarea id="io-area" class="io-area" readonly></textarea>
    </section>
</div>

<div class="footer-controls">
    <button class="btn-play" onclick="playSFX()">PLAY SFX</button>
</div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function updateDisplay() {
        document.querySelectorAll('input[type="range"]').forEach(input => {
            const valEl = document.getElementById(input.id + '-val');
            if(valEl) valEl.textContent = input.value;
        });
        const m = document.getElementById('mix').value;
        document.getElementById('mix-v1').textContent = Math.round((1-m)*100) + "%";
        document.getElementById('mix-v2').textContent = Math.round(m*100) + "%";
    }
    document.querySelectorAll('input').forEach(el => el.addEventListener('input', updateDisplay));
    updateDisplay();

    function setupOsc(type, freq, slide, atk, rel, vol, now) {
        let node; const g = audioCtx.createGain();
        if(type === 'noise') {
            node = audioCtx.createBufferSource();
            const b = audioCtx.createBuffer(1, audioCtx.sampleRate, audioCtx.sampleRate);
            const d = b.getChannelData(0);
            for (let i = 0; i < b.length; i++) d[i] = Math.random() * 2 - 1;
            node.buffer = b;
        } else {
            node = audioCtx.createOscillator(); node.type = type;
            node.frequency.setValueAtTime(freq, now);
            node.frequency.exponentialRampToValueAtTime(Math.max(1, freq + slide), now + atk + rel);
        }
        g.gain.setValueAtTime(0, now);
        g.gain.linearRampToValueAtTime(vol, now + atk);
        g.gain.exponentialRampToValueAtTime(0.001, now + atk + rel);
        node.connect(g);
        return { connect:(n)=>g.connect(n), start:(t)=>node.start(t), stop:(t)=>node.stop(t) };
    }

    function playSFX() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const s = getSettings(), now = audioCtx.currentTime;
        if(s.mix < 1) { // OSC1 
            const osc1 = setupOsc(s.type, s.freq, s.slide, s.atk, s.rel, (1-s.mix)*0.5, now);
            osc1.connect(audioCtx.destination); osc1.start(now); osc1.stop(now + s.atk + s.rel + 0.1);
        }
        if(s.mix > 0) { // OSC2
            const osc2 = setupOsc(s.type2, s.freq2, s.slide2, s.atk2, s.rel2, s.mix*0.5, now);
            osc2.connect(audioCtx.destination); osc2.start(now); osc2.stop(now + s.atk2 + s.rel2 + 0.1);
        }
    }

    function getSettings() {
        const ids = ['mix','type','freq','slide','atk','rel','type2','freq2','slide2','atk2','rel2'];
        let config = {};
        ids.forEach(id => {
            const el = document.getElementById(id);
            config[id] = isNaN(parseFloat(el.value)) ? el.value : parseFloat(el.value);
        });
        return config;
    }

    function exportCode() {
        const s = getSettings();
        let code = `// SFX_SMART_PARAMS: ${JSON.stringify(s)}\nfunction playSFX(ctx) {\n    const now = ctx.currentTime;\n`;
        
        if (s.mix <= 0) {
            code += `    // Single OSC 1 Mode\n    const osc = setupOscNode(ctx, "${s.type}", ${s.freq}, ${s.slide}, ${s.atk}, ${s.rel}, 0.5, now);\n    osc.connect(ctx.destination); osc.start(now); osc.stop(now + ${s.atk + s.rel + 0.1});\n`;
        } else if (s.mix >= 1) {
            code += `    // Single OSC 2 Mode\n    const osc = setupOscNode(ctx, "${s.type2}", ${s.freq2}, ${s.slide2}, ${s.atk2}, ${s.rel2}, 0.5, now);\n    osc.connect(ctx.destination); osc.start(now); osc.stop(now + ${s.atk2 + s.rel2 + 0.1});\n`;
        } else {
            code += `    // Dual OSC Mode\n    const osc1 = setupOscNode(ctx, "${s.type}", ${s.freq}, ${s.slide}, ${s.atk}, ${s.rel}, ${(1-s.mix).toFixed(2)} * 0.5, now);\n    const osc2 = setupOscNode(ctx, "${s.type2}", ${s.freq2}, ${s.slide2}, ${s.atk2}, ${s.rel2}, ${s.mix.toFixed(2)} * 0.5, now);\n    osc1.connect(ctx.destination); osc2.connect(ctx.destination);\n    osc1.start(now); osc2.start(now);\n`;
        }
        code += `}`;
        document.getElementById('io-area').value = code;
    }
</script>
</body>
</html>